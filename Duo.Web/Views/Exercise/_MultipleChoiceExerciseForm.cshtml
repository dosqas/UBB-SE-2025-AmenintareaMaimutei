@model DuoClassLibrary.Models.Exercises.MultipleChoiceExercise

<div class="card text-dark">
    <div class="card-body">
        <h5 class="mb-3">@Model.Question</h5>
        <div class="vstack gap-2">
            @for (int i = 0; i < Model?.Choices?.Count; i++)
            {
                var choice = Model.Choices[i];
                var id = $"choice_{i}";
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="selectedAnswer" id="@id" value="@choice.Answer" data-is-correct="@choice.IsCorrect.ToString().ToLower()" />
                    <label class="form-check-label" for="@id">@choice.Answer</label>
                </div>
            }

            @foreach (var choice in Model.Choices.Where(c => c.IsCorrect))
            {
                <input type="hidden" name="correctAnswers" value="@choice.Answer" />
            }
        </div>
        <div id="mcFeedback" class="mt-3 fw-semibold"></div>
    </div>
</div>

@section Scripts {
    <script>
        // Function to validate the multiple choice answer
        function validateMultipleChoice() {
            const selected = document.querySelector('input[name="selectedAnswer"]:checked');
            const correctAnswers = Array.from(document.querySelectorAll('input[name="correctAnswers"]')).map(el => el.value);
            const feedback = document.getElementById('mcFeedback');

            if (!selected) {
                feedback.innerHTML = '<div class="alert alert-warning">Please select an answer.</div>';
                return false;
            }

            const isCorrect = selected.getAttribute('data-is-correct') === 'true';
            if (isCorrect) {
                feedback.innerHTML = '<div class="alert alert-success"><i class="bi bi-check2-circle"></i> Correct! Well done.</div>';
            } else {
                feedback.innerHTML = `<div class="alert alert-danger"><i class="bi bi-x-circle"></i> Incorrect. Correct answer(s): <strong>${correctAnswers.join(', ')}</strong>.</div>`;
            }
            
            // Disable all radio buttons after submission
            document.querySelectorAll('input[name="selectedAnswer"]').forEach(input => {
                input.disabled = true;
            });

            return true;
        }

        // Add the validation function to the window object so it can be accessed from the parent form
        window.validateMultipleChoice = validateMultipleChoice;
    </script>
}
